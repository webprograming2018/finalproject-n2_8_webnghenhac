var suggestData = {"a":["andiez","ai khóc nỗi đau này remix","anhnhoemnhieulam","alan walker","ai khóc nỗi đau này","anh sẽ ôm em đến hết mùa hoa rơi","attention","acoustic việt","anh muốn nghe giọng em","avicii","andree","adele","anh thèm được ngủ","am thanh cua ma tuy","andree right hand","after the afterparty","anh chỉ cần có lý do thôi","ai chờ ai","austin mahone","ativa","andiez","anhnhoemnhieulam","anh sẽ ôm em đến hết mùa hoa rơi","anh muốn nghe giọng em","andree","anh thèm được ngủ","andree right hand","anh chỉ cần có lý do thôi","anh đi nhé","anh trai nắng đi tìm em gái mưa","anh nhớ em nhiều lắm","anh sẽ nhớ đến khi quên được em","anh se hoi han","anh yêu em remix","anh muốn nghe giọng em nói","anh sẽ hối hận remix","anh không muốn bất công với em","anh không nhớ em","anh đi nhé remix","anh chẳng sao mà"],"b":["buồn không em","binz","bùa yêu","bốc bát họ","bùa yêu remix","bua yeu","buồn không em đạt g","bts","bray","buồn không em remix","buon khong em","bua yeu remix","bo nguyen","bê bê bê quá","b ray","banana","billie eilish","blackpink","bay phong 2018","bốc bát họ remix","binz","billie eilish","binz da poet","big bang","bitches broken hearts","bi shady","biết khi nào gặp lại","big city blues","big room never dies","bich phuong","bigbang","biết khi nào gặp lại mỹ tâm","binz sofar","bikini body","biet khi nao gap lai","big daddy","bigroom never dies","bigdaddy","bi tây","binz sao cũng được","buồn không em","bua yeu","buồn không em đạt g","buồn không em remix","buon khong em","bua yeu remix","bua yeu nonstop","buon khong em remix","buông bàn tay thật nhanh","buồn của anh","buon cua anh","buon cua anh remix","buồn không em masew","buồn của anh remix","buon khong em dat g","bung bet het roi","buồn vương mi","buồn không em nonstop","bua yeu thai hoang","bui anh tuan","banana","bay phong 2018","baam","bay phòng","bao dem","bass boosted car music mix 2018","bat la be","banana vol 13","baam momoland","baby im wrong","banh mi chay","bass down low long nhat","bac si hai","back to you","baby gudnite","bae don't cry koo","banh mi sai gon 2","baby shark","ba la ba la ba la","bay"],"c":["có ai thương em như anh","catena","chuoi tay","cô y tá phê đá","chạm đáy nỗi đau","cuộc sống em ổn không","chạy ngay đi","cá hồi hoang","chill out","changes xxxtentacion","chuối tây","co y ta phe da","con meo hoang","crush","chúng ta không giống nhau","chich con gai phai xinh","cham day noi dau","chill","cam","co ai thuong em nhu anh","chuoi tay","chạm đáy nỗi đau","chạy ngay đi","chill out","changes xxxtentacion","chuối tây","chúng ta không giống nhau","chich con gai phai xinh","cham day noi dau","chill","charlie puth","chuoi tay vol 13","chúng ta không giống nhau remix","chẳng bao giờ quên remix","changes","chạm đáy nỗi đau remix","chưa bao giờ","chay ngay di","chạy ngay đi remix","cham day noi dau remix","catena","cam","catena tóc tiên","call me koo","cant take my eyes off of you","canh hong phai","cau be but chi","call me","ca hoi hoang","canh hong phai remix","cardi b","call out my name","careless whisper","cafe thuốc lá và những ngày vui","cant help falling in love","catena touliver","canh sat hinh su","calvin harris","cavetown","candy lắk"],"d":["duyên mình lỡ","dj tino","dj thai hoang","dung nhu thoi quen","deep house","dung quen ten anh","duyên mình lỡ remix","dj minh tri","dj banana","dj zinh","deep house trôi từ đầu đến cuối","dsk","dustee","dj tit","duyen minh lo","dj tilo","dung nhu thoi quen remix","dj thái hoàng","dung quen ten anh remix","deep house 2018"],"e":["em mới là người yêu anh","em van chua ve","edm","em se hoi han","edm gây nghiện","em vẫn chưa về","em mới là người yêu anh acoustic","em vẫn chưa về remix","emme đạt g","epiphany bts","em gái mưa","epiphany","everyday spacespeakers","em sẽ hối hận","edm 2018","emme","em đéo biết nữa anh ơi","em se hoi han remix","em dạo này","epiphany jin"],"f":["feel me selena gomez","fake love","friends","fly away","future da producer","friends marshmello","faded","feel me","forever young blackpink","fuck love","fake love bts","fefe","fuck love xxxtentacion","fly away thefatrat","fly hight 2018","future house","full track thái hoàng","fire bts","forever young","faded remix"],"g":["girls like you maroon 5","ghé qua","gucci gang","girls like you","giữ lấy làm gì","g house","god's plan","giang ơi","get looze","gashina","ghé thăm","giang tô","gia tu bay lac","gaztik","gia vo thuong anh duoc khong","gọi là phúc","god is a woman ariana grande","girl like you","gọi tên em trong đêm","galaxy bolbbalgan4"],"h":["hoa bằng lăng remix","hoa bằng lăng","hôm nay tôi buồn","havana","huyen thoai nhac ke","hoa bang lang","hải sâm","hà anh tuấn","hisam","havana remix","hoa vinh","hd mix","hello","heartbeat nightcore","handclap","history rich brian","học tiếng mèo kêu","hội đồng phê","hoaprox","hotline bling"],"i":["in my feelings drake","instagram dean","in the night mike hao","in my feelings","ikon","indie vietnam","im not her","i need your love","i hate you i love you","in the dark mike hao","ignite alan walker","idontwannabeyouanymore","i'm not her","imagine dragons","ikon killing me","iu","ignite","in the night","im th","instagram"],"j":["justin bieber","justatee","just like this","just like this remix","jgkid","jazz","jocelyn flores","jaykii","joji","jimmy nguyễn","jazz chill","jay park","j fla","jfla","jungkook","japan","jav 18","jodiestarling's","jungkook cover","jombie"],"k":["khói","killing me ikon","khoidarealest","khang chivas","koo","krazy binz","kiki do you love me","khoảng cách tình yêu","karik","khoi","khoan khoan từ từ chứ em ơi","kiên","khi cô đơn em nhớ ai","kasho club","keke do you love me","krazy","kay trần","kygo","kiếp thứ ii","không chỉ là thích"],"l":["lunisolar","lil pump","linh ku","lạ lùng","lofi","love scenario","lunisolar shaun","long nhật","lỡ thương một người","le bao binh","lê bảo bình","loa đèn sài gòn mấy mé ơi","look at me","lk nhac tre remix 2018","lofi hip hop","love yourself","la con gai phai xinh","lê cát trọng lý","lofi chill","let her go","la con gai phai xinh","lana del rey","la vie en rose","latata","lac troi","la la la","lauv","la la la teejay remix","la lung","lang quen chieu thu","lai day anh cho nghe nhac hay","lac mong di em","lam trường","lang quen chieu thu remix","la la la remix","latata g i-dle","lac kiu","lalala","lau dai tinh ai remix","lac troi remix","lunisolar","lunisolar shaun","lucid dream","lucid dreams juice wrld","luyến","lullaby","lullaby r3hab","luôn là mình","lucky","lucid dreams","luc luca","lund broken","luân tang","luot di nhanh chong","lung pres","luxy lounge","luot qua mat nuoc nhu la sao bang","luật bất thành văn","luôn là mình dalab","lucas steve","lil pump","linh ku","lil peep","little do you know","live it up","liệu anh có thể yêu em","linh cáo","little homie","linhlee 0946233333","lien khuc nhac tre remix 2018","lil knight","liên khúc nhạc trẻ remix 2018","linkin park","lip and hip","lil uzi vert","lil xan","linh ku remix","lien khuc nhac tru tinh","live it up world cup","like i do","lofi","love scenario","long nhật","loa đèn sài gòn mấy mé ơi","look at me","lofi hip hop","love yourself","lofi chill","long nhat","lost frequencies","love the way you lie","long chen","loanh quanh","loving you sunny","look alive","loa den sai gon may me oi","loving you","lovely billie eilish","love me like you do","look what you made me do"],"m":["mưa trên cuộc tình remix","mike hao","minh tri","minh tri 12","mua tren cuoc tinh remix","mưa trên cuộc tình","mr siro","mỹ tâm","martin garrix","mua tren cuoc tinh","minh trí","my tam","muộn màng là từ lúc","masew","mai thuý","mình yêu nhau từ kiếp nào","maroon 5","mưa trên cuộc tình nonstop","mashup hit vpop 2018","mua tren cuoc tinh nonstop","mike hao","minh tri","minh tri 12","minh trí","min","mi gente","mike hao 1980s","midsummer madness","mixtape","mine","mix viet 2018","mixtape my style my name","migos","mic drop","mi gente remix","mike hao in the night","minh trí 12","mine bazzi","minh yeu nhau tu kiep nao","missing you g dragon","mong kiếp sau vẫn là anh em remix","momoland","mong kiep sau van la anh em","more than you know","monstar","monster","moonlight","modern talking","mot thoi da xa","monstercat","mot thoi da xa remix","mouzze","moi em ve voi doi cua anh","mozart","mollado","moonlight xxxtentacion","mong cho anh","mong anh không nhận được cái này vào lúc 4 giờ sáng","monody","mong kiếp sau vẫn là anh em"],"n":["nonstop 2018","nonstop 2018 bass đập sấp mặt lờ","người ta có thương mình đâu","nonstop vinahouse 2018","nonstop vietmix 2018","nhac bay phong 2018","nguyên team đi vào hết","nonstop","nha","ntdvh","nst","nhạc bay phòng","nonstop bùa yêu","nst dung nhu thoi quen","nhac tre remix","nguoi ta co thuong minh dau","nocturnal shaun","ngọt","ngơ","nhạc ke huyền thoại","nonstop 2018","nonstop 2018 bass đập sấp mặt lờ","nonstop vinahouse 2018","nonstop vietmix 2018","nonstop","nonstop bùa yêu","nocturnal shaun","nonstop 2019","nonstop hoa bang lang","nonstop bua yeu","nonstop đừng quên tên anh","nonstop 2018 viet mix","nonstop mưa trên cuộc tình","no brainer","nostop 2018","nonstop dung quen ten anh","nonstop hoa bằng lăng","nonstop đừng như thói quen","noo phuoc thinh","nontop viet mix 2018","nacode","nah","nandemonaiya","nah nguyen","nam nay tao van la dan choi","natale","natural imagine dragons","nam quốc sơn hà","nah rapper","natale dj","nandemonaiya remix","nasty","nasty hung 88","nam kun","natural","nam den","na tra","naruto","nay em oi","narcos","new soul","new rules","new soul remix","nevada","never enough","newsoulz","neffex","never be the same","new soul remix tik tok","neu anh di","new thang","neu em con ton tai","new nst","neu em con ton tai remix","new rules remix","neverland kshmr","new oulz","new vinahouse dung ai nhac ve co ay","new 85 club","never be alone"],"o":["ok em tới đây đi em yêu","ok vinahouse","osad","o sao be khong le","onionn","ocean martin garrix","offonoff","ok em toi day di em yeu","okey dokey","octobee","oh my seventeen","ocean","ok tới đây đi em yêu","one kiss","ok em tới đây đi em yêu remix","oke em toi day di em yeu","ocean eyes","ofa lounge","only you","ovan"],"p":["phía sau em","phi thành","phép màu","please dont go","phia sau em","psycho","phải chia tay thôi","phi thanh","poc poc","panama","phai dau cuoc tinh","pretty girl","par sg","piano","perfect ed sheeran","phan mạnh quỳnh","phút ban đầu","perfect","paris in the rain","phai dấu cuộc tình remix","phía sau em","phi thành","phép màu","phia sau em","phải chia tay thôi","phi thanh","phai dau cuoc tinh","phan mạnh quỳnh","phút ban đầu","phai dấu cuộc tình remix","phía sau một cô gái","phuc nelly","phố không em","phía sau em kay trần thảo phạm","phong toc dai","phép màu bray","phía sau em remix","phia sau mot co gai","phai dấu cuộc tình","phạm hồng phước"],"q":["quang cuốn","quang bùi deejay","qua ta","quang lap","quang tao cai boong","quên em trong từng cơn đau","quan trọng là thần thái","quach trong","quang lập","quách trọng","quên em trong từng cơn đau remix","quang lê","quang bùi","quyếch","qua những tiếng ve","quỷ tha ma bắt","quang tèo","quỳnh hương","quên bạn trai em đi","quái vật tí hon","quang cuốn","quang bùi deejay","qua ta","quang lap","quang tao cai boong","quên em trong từng cơn đau","quan trọng là thần thái","quach trong","quang lập","quách trọng","quên em trong từng cơn đau remix","quang lê","quang bùi","quyếch","qua những tiếng ve","quỷ tha ma bắt","quang tèo","quỳnh hương","quên bạn trai em đi","quái vật tí hon"],"s":["so far binz","send it","send it austin mahone","shaun","sai người sai thời điểm","suýt nữa thì","shaun way back home","something just like this","sai người sai thời điểm remix","sao em nỡ jaykii","sad xxxtentacion","sao cũng được","shaun lunisolar","so far","sofar binz","sent it","save me","sad","sao em nỡ","send it to my phone"],"t":["that girl","that girl olly murs","tháng 6 của anh","thái hoàng","thai hoang","touliver","tình đắng như ly cà phê","toan teng","thuốc lá và cà phê","toan teng vol 5","thai hoang 2018","thập tam muội","they said","that girl tik tok","thế thôi","trang","tóc tiên","thương nhiều hơn là nói","tâm sự tuổi 30","tháng 6 của anh khói","that girl","that girl olly murs","tháng 6 của anh","thái hoàng","thai hoang","thuốc lá và cà phê","thai hoang 2018","thập tam muội","they said","that girl tik tok","thế thôi","thương nhiều hơn là nói","tháng 6 của anh khói","thinh bay lung tung","tháng tư là lời nói dối của em","thái hoàng remix","thien hi","that girl remix","tháng 7 của anh","thanh koi","tino","tilo","tinh don phuong","tik tok","tinh yeu ma tuy","tidi","tinh dang nhu ly ca phe","tik tok trung quốc","tiesto","tinh anh em","tiên tiên","tinh don phuong remix","tin anh dt","tien hanya","timber","ti vu","ti duc 10 tuoi","tinle","titanium","tim mot nguoi nhu the","touliver","toan teng","toan teng vol 5","tomorrowland 2018","toan teng vol 3","too good at goodbyes","toc tien","toàn teng","tommy djtommy","toan teng vol 4","tofu","tong teng vol 5","tokyo drift","tommy","tom milano","toilavu","tobu","toàn teng vol 5","too good at goodbyes sofia karlberg","touliver remix"],"u":["um si la bum","ung hoang phuc","uyên pím","untitled 2014 gdragon","until you","us uk 2018","uyên linh","uncover","u co anh day","under","unravel","underground rap viet","um si la bum remix","untitled 2014","uptown funk","umsilabum","ultra music festival 2018","us uk","uchiage hanabi","ung hoang phuc remix"],"v":["vinahouse 2018","viet mix 2018","viet mix 2018 hay nhat","vũ","vinahouse","viet mix","việt mix 2018","vera madsen","vinahouse 2018 thai hoang","vietmix","vitamin phê","vo hinh trong tim em","việt mix","vô thường karik","vinagang","vì anh thương em remix","vì anh thương em","vo tan","vô thường","viêt mix 2018"],"w":["way back home shaun","way back home","way back home shaun remix","we dont talk anymore","way back home shaun edm","waiting for love","what do you mean vietnamese nonstop 2017","what are words","way back home lời việt","wishkey koo","what do you mean","walk it talk it","way back home shaun acoustic","when we were young","welcome to the party","whiskey koo andiez","wowy","why not me","winner","westlife"],"r":["reality","rời bỏ","remix viet 2018","richchoi","reality remix","rồi người thương cũng hoá người dưng","rời bỏ remix","rhymastic","roi bo","rap việt underground","remix","rich kid","reality lost frequencies","roi bo remix","river","russ","rap","rockstar","rich kid rich choi","rich brian"],"y":["yêu rồi","yêu 5","yellow claw","yêu","yêu đương","yêu em qua dòng tin nhắn","yêu rồi gạo nếp gạo tẻ","yunbray","yêu thương ngày đó","yêu nhầm người","young dumb and broke","yeu nham nguoi","yếu đuối","you are my sunshine","yêu hết nỗi đau này","you are the reason","yesterday once more","yêu nhầm người remix","yêu xa","yêu rồi tino"]};

var globalEvent = {
  touch : false,
  swipeLeft: false,
  swipeRight: false,
  swipeDown: false,
  swipeUp: false,
  clickBallVolume: false,

  reset : function(){
    this.touch = false;
    this.swipeLeft = false;
    this.swipeRight = false;
    this.swipeDown = false;
    this.swipeUp = false;
  }
}

var mouseObject = {
  posX: null,
  posY: null,

  setCurrentPos : function(x, y){
    this.posX = x;
    this.posY = y;
  },

  isSwipeLeft : function(x){ 
    if ( this.posX ) { return x < (this.posX - 70) ? true : false}
    else { return false}
  },
  isSwipeRight : function(x){
    if (this.posX) {return x > (this.posX + 70 ) ? true : false}
    else {return false}
  },
  isSwipeDown : function(y) {
    if (this.posY) {return y > (this.posY + 100) ? true : false }
    else {return false}
  },
  isSwipeUp : function(y) {
    if (this.posY) {return y < (this.posY - 100) ? true : false }
    else {return false}
  },
}

document.addEventListener('mouseup', function(){
  globalEvent.clickBallVolume = false;
})

window.addEventListener('DOMContentLoaded', function(){
  // define Variable
  var listTrack = document.getElementById('listTrack'),
      speakerButton = document.getElementById('speaker-button'),
      bulletListTrack = document.getElementById('list-track-bullet'),
      bulletHome = document.getElementById('home-bullet'),
      bulletLyric = document.getElementById('lyric-bullet'),
      listBtn = document.getElementById('list-btn'),
      gridBtn = document.getElementById('grid-btn'),
      settingBtn = document.getElementById('settingBtn'),
      modalSetting = document.getElementById('modalSetting'),
      settingItem = document.getElementsByClassName('setting__item')
      header = document.getElementById('header'),
      playViewControl = document.getElementById('play-view__control'),
      inputSearch = document.getElementsByClassName('input-search-01'),
      searchResult = document.getElementById('search-result-wrapper'),
      closeBtnModal = document.getElementsByClassName('close-btn'),
      ballVolume = document.getElementById('ballVolume'),
      pause_or_play_btn = document.getElementById('pause_or_play_btn'),
      speaker_volume = document.getElementById('speaker-volume'),
      speaker_progress = document.getElementById('speakerProgress'),
      favoriteListBtn = document.getElementById('favoriteListBtn'),
      upload_link = document.getElementById('upload_link'),
      modal_upload = document.getElementById('modalUpload')
      ;
      var indexSwiper = 0;
  // console.log(speaker_volume.getBoundingClientRect().y);
  var speaker_volume_posY = speaker_volume.getBoundingClientRect().y,
      volume_posY = 50;

  const self = this;

  //////////////////// define method
  var isClick = e=> e.type === "click"?true : false;
  var toggleModify = type=>{
    console.log(type);
    type === "grid" ? listTrack.classList.add('toggle-modify') : listTrack.classList.remove('toggle-modify');
  }

  var toggleClass = (element, className)=>{
    console.log(element.classList.contains(className));
    element.classList.contains(className) ? element.classList.remove(className) : element.classList.add(className);
  }

  var toggleMenu = ()=>{
    toggleClass(header, "hide");
  }

  var toggleControl = ()=> {
    toggleClass(playViewControl, "hide");
  }








////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////// SC CODE ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////btn//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// var url = 'https://api.soundcloud.com/tracks?client_id=ec8f5272bde9a225c71692a876603706';
// $.getJSON(url, function (tracks) {
//  console.log(tracks);
// });
// var favoriteList = window.localStorage.getItem("favoriteList")? window.localStorage.getItem("favoriteList"): [];
var favoriteList = [];
var SClistTrack = [];
var mainTrack= {
  indexTrack: null,
  status : "pause",
  setIndex: function(index){this.indexTrack = index},
  toggle: ()=>{this.status = this.status==="play"?"pause":"play"},
  isPlay: ()=>status==="play",
  play: function(){
    this.status = "play";
  },
  pause: function(){
    this.status = "pause";
  }
};

// update playview 
let updatePlayView = (index, list)=>{
  $('.play-view__image img').attr('src', list[index].user.avatar_url); 
  $('.play-view__information .textbox__title').text( list[index].title );
  $('.play-view__information .textbox__subtitle').text(list[index].user.username);
}

// play a track
let playFunc = ()=>{
  if (window.sound) {
    $('#pause_or_play_btn').attr('src', 'assets/images/pause.png');
    window.sound.play();
    mainTrack.play();
  }
}

// pause a track
let pauseFunc = ()=>{
  $('#pause_or_play_btn').attr('src', 'assets/images/play.png');
  if (window.sound) {
    window.sound.pause();
    mainTrack.pause();
  }
}

//hide search-result-wrapper
let hideSearchResult = () => {
  $('#search-result-wrapper').removeClass('show');
}
//show search-result-wrapper

let showSearchResult = () => {
  $('#search-result-wrapper').addClass('show');
}

// use index to play track , change track
let playTrackWithIndex = async (index, list)=>{
  pauseFunc();
  updatePlayView(index, list);
  mainTrack.setIndex.call(mainTrack, index);
  // console.log();
  window.sound = await SC.stream('tracks/'+ parseInt(list[index].id));
  playFunc();
}

SC.initialize({
  client_id: 'ec8f5272bde9a225c71692a876603706'
});

let searchTrackByKey = (text)=>{
  // find all sounds of buskers licensed under 'creative commons share alike'
  SC.get('/tracks', {
    q: text,
    // license: 'cc-by-sa'
  }).then(function (tracks) {
    SClistTrack = tracks;
    var html ='';
    tracks.forEach((element, index) => {
       // html += '<li class="item"><span href="#" class="suggestText" onclick="clickTrackSuggest">'+element.title+'</span></li>';
       html +=  '<li class="item">\
              <div class="TrackItem " data-trackIndex="'+index+'">\
                <div class="media-wrapper">\
                  <img src="' + element.user.avatar_url + '" alt="'+element.user.username+'" />\
                </div>\
                <p class="title">'+element.title+'</p>\
                <p class="author">'+element.user.username+'</p>\
              </div>\
            </li>'
    });
   var searchresult = $('#listMusic').html(html);
  });
}

$(document).ready(function () {
  $('#but').click(function (e) {
    e.preventDefault();
    var searchValue = $("#search").val();
    searchTrackByKey(searchValue);
    hideSearchResult();
  });

  $('#pause_or_play_btn').on('click', function(event) {
    event.preventDefault();
    mainTrack.toggle();
    mainTrack.isPlay() ? pauseFunc() : playFunc();
  });

  $('#next_btn').on('click', function(event) {
    event.preventDefault();
    playTrackWithIndex( mainTrack.indexTrack + 1, SClistTrack );
  });

  $('#prev_btn').on('click', function(event) {
    event.preventDefault();
    playTrackWithIndex( mainTrack.indexTrack - 1, SClistTrack );
  });

  $('#search').on('keyup', function(event) {
    let arr = Object.keys(suggestData);
    let inputText = $('#search').val();
    // let inputText = "a";
    let html = '';
    console.log(inputText);
    arr.forEach(e=>{
      if (e === inputText[0]) {
        let rsArray = suggestData[e];
        // let regexText =  + '/g';
        var regex = new RegExp( '^' + inputText , "g");
        rsArray.forEach(ele=>{
          if(ele.match(regex)) {
            console.log(ele , inputText)
            html+= '<li class="item">' + ele + '</li>';
          }
        });
        $('#search-result').html(html);
        showSearchResult();
        return 0;
      }
    });
    if (html.length === 0) {
      hideSearchResult();
    }
  });


  // $('#listMusic .TrackItem').on('click', function(event) {
  //  event.preventDefault();
  //  console.log('ok');
    // console.log();
  // });
});

$(document).on('click', '#search-result li', function(event) {
  event.preventDefault();
  console.log('ok');
  searchTrackByKey($(this).text());
  hideSearchResult();
});

$(document).on('click', '#listMusic .TrackItem', async function(event) {
  event.preventDefault();
  let index = parseInt($(this).attr('data-trackIndex'));
  playTrackWithIndex(index, SClistTrack);
});

// $(document).on('click', '#modalFavoriteList .TrackItem', async function(event) {
//   event.preventDefault();
//   let index = parseInt($(this).attr('data-trackIndex'));
//   console.log(favoriteList);
//   localStorage.setItem('idmusic',favoriteList[index].idMusic);
//   $('#like-btn').addClass('like');
//   playTrackWithIndex(index, favoriteList);
// });// đoạn này ngày xưa lưu bài hát vào local storage , giwof ko cần nữa ok đệ biết

//init from danh sach yeu thich
var idtrackrequestInt= parseInt(idtrackrequest);
if(!!idtrackrequestInt){
  pauseFunc();
  $('.play-view__image img').attr('src', urlrequest); 
  $('.play-view__information .textbox__title').text( title );
  $('.play-view__information .textbox__subtitle').text(author);
  mainTrack.setIndex.call(mainTrack, 1);
  (async ()=>{
    window.sound= await SC.stream('/tracks/'+idtrackrequestInt);
    playFunc();
  })();
}

$('input[name="alarm-submit"]').on('click', function(event) {
  event.preventDefault();
  let t = $('input[name="alarm-input"]').val();
  let time = t*60*1000;
  console.log(time);
  setTimeout(function(){
    pauseFunc();
  }, time)
});

$(favoriteListBtn).on('click', function(event) {
  event.preventDefault();
  favoritemusic();
  $('#modalFavoriteList').toggleClass('show');
});
function favoritemusic(){
  console.log(username);
  var url = 'http://localhost:8089/Muzic/rest/favorite/'+username;
  favoriteList = [];
  fetch(url)
    .then(function(response) {
      return response.json();
    })
    .then(function(myJson) {
      console.log((myJson));
      for(var i =0;i< myJson.length;i++){
        favoriteList.push(
          {
            idMusic: myJson[i].id,
            id: myJson[i].idTrack,
            index: i,
            title: myJson[i].title,
            user: {
              avatar_url: myJson[i].avatar_url,
              username: myJson[i].authorname
            }
          }
        );
      }
      let html = '';
	    favoriteList.forEach(element=>{
	      html +=  '<li class="item">\
	                  <div class="TrackItem " data-trackIndex="'+element.index+'">\
	                    <div class="media-wrapper">\
	                      <img src="' + element.user.avatar_url + '" alt="'+element.user.username+'" />\
	                    </div>\
	                    <p class="title">'+element.title+'</p>\
	                    <p class="author">'+element.user.username+'</p>\
	                  </div>\
	                </li>'
	    });

	    $('#modalFavoriteList .favorite-list-box').html(html);
    });
}
let setLocalFavoriteList = ()=>{
  window.localStorage.setItem("favoriteList", JSON.stringify(favoriteList));
  console.log(window.localStorage)
}
console.log(idlove);
if(!!idlove){
	console.log("nice")
  $('#like-btn').addClass('like');
  localStorage.setItem('idlove',idlove);
}
$('#like-btn').on('click', function(event) {
	  event.preventDefault();
	  try {
      $(this).toggleClass('like');
      var nameLike = $(this).attr("class").split(" ")[1];
      var url = 'http://localhost:8089/Muzic/rest/favorite';
      if(nameLike === "like"){
	    var data= {
	        "authorname": SClistTrack[mainTrack.indexTrack].user.username,
	            "iduser": id,
	            "title": SClistTrack[mainTrack.indexTrack].title,
	            "avatar_url": SClistTrack[mainTrack.indexTrack].user.avatar_url,
	            "idTrack": SClistTrack[mainTrack.indexTrack].id,
      }
        fetch(url, {
          method: 'POST', // or 'PUT'
          body: JSON.stringify(data),
          headers:{
            'Content-Type': 'application/json'
          }
        }).then(res => res.json())
        .then(response => console.log('Success:', console.log(response)))
        .catch(error => console.error('Error:', error));
      }else {
        // var idmusic = localStorage.getItem('idmusic');
        var id = localStorage.getItem('idlove');
        var urlDelete ='http://localhost:8089/Muzic/rest/favorite/'+id;
          fetch(urlDelete, {
            method: 'DELETE', // or 'PUT'
            headers:{
              'Content-Type': 'application/json'
            }
          }).then(res => res.json())
          .then(response => console.log('Success:', console.log(response)))
          .catch(error => console.error('Error:', error));
      }
	   
	    
	  }
	  catch(err) {
	    console.log('sai dau do roi',err);
	  }
});

$(inputSearch).focusin(function(event) {
  event.preventDefault();
  console.log('focusin');
    showSearchResult();
});

// $(inputSearch).on('blur', function(event) {
//   event.preventDefault();
//   console.log(event.target);
//   // if (!$('#search-result-wrapper').is(event.target) && $('#search-result-wrapper').has(event.target).length === 0 ) {
//     // console.log("close search result");
//     hideSearchResult();
//   // }
// });



////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////// END SC CODE ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////







  // handle listTrack event show & hide on mobile
  const dashBoard = document.getElementsByClassName('Dashboard-01')[0];
  window.addEventListener("touchstart", function(e){
    let touches = e.changedTouches;
    mouseObject.setCurrentPos( touches[0].pageX, touches[0].pageY );
  });

  dashBoard.addEventListener("touchmove", function(e){
  })

  window.addEventListener("touchmove", function(e){
    let touches = e.changedTouches;
    console.log(mouseObject.posY + "posY", touches[0].pageY + "end Y");
    if ( mouseObject.isSwipeLeft( touches[0].pageX)){
      globalEvent.swipeLeft = true;
      console.log("swipeLeft");
    }

    if ( mouseObject.isSwipeRight(touches[0].pageX) ) {
      globalEvent.swipeRight = true;
      console.log("swipeRight");
    }
    if (mouseObject.isSwipeDown(touches[0].pageY )) {
      globalEvent.swipeDown = true;
      console.log('swiperDown');
    }

    if (mouseObject.isSwipeUp(touches[0].pageY )) {
      globalEvent.swiperUp = true;
      console.log('swiperUp');
    }

    // control display menu
    if (globalEvent.swipeDown) {
      $('.menu-wrapper').addClass('show');
      console.log('hello');
    } else if (globalEvent.swiperUp) {
      $('.menu-wrapper').removeClass('show');
      $('.menu-01').removeClass('show');
      $('.trigger').removeClass('active');
    }

    // handle show list track
    if (globalEvent.swipeRight) {
      indexSwiper+=1;
      indexSwiper%=3;
      
    }
    if (globalEvent.swipeLeft) {
      indexSwiper -=1;
      if (indexSwiper < 0) {
        indexSwiper = 2;
      }
    }
    if (indexSwiper === 1) {
      listTrack.classList.add('show');
      $('#lyric').removeClass('show');
      $('.bullet').removeClass('active');
      bulletListTrack.classList.add('active');
    } else if (indexSwiper === 0) {
      listTrack.classList.remove('show');
      $('#lyric').removeClass('show');
      $('.bullet').removeClass('active');
      bulletHome.classList.add('active');
    } else if (indexSwiper === 2) {
      $('#lyric').addClass('show');
      listTrack.classList.remove('show');
      $('.bullet').removeClass('active');
      bulletLyric.classList.add('active');
    }

    console.log(indexSwiper);
    // reset globalEvent
    globalEvent.reset();
  });

  // handle swiper on desktop
  window.addEventListener('mousedown', function(e){
    mouseObject.setCurrentPos( e.pageX, e.pageY );
    console.log(e.pageX, e.pageY);
  })

  window.addEventListener('mouseup', function(e){
    // mouseObject.setCurrentPos( e.pageX, e.pageY );
    if (mouseObject.isSwipeRight(e.pageX, e.pageY)) {
      globalEvent.swipeRight = true;
    }

    if(mouseObject.isSwipeLeft(e.pageX, e.pageY)) {
      globalEvent.swipeLeft = true;
    };

    // handle show list track
    // handle show list track
    if (globalEvent.swipeRight) {
      indexSwiper+=1;
      indexSwiper%=3;
      
    } 
    if (globalEvent.swipeLeft) {
      indexSwiper -=1;
      if (indexSwiper < 0) {
        indexSwiper = 2;
      }
    }
    if (indexSwiper === 1) {
      listTrack.classList.add('show');
      $('#lyric').removeClass('show');
      $('.bullet').removeClass('active');
      bulletListTrack.classList.add('active');
    } else if (indexSwiper === 0) {
      listTrack.classList.remove('show');
      $('#lyric').removeClass('show');
      $('.bullet').removeClass('active');
      bulletHome.classList.add('active');
    } else if (indexSwiper === 2) {
      $('#lyric').addClass('show');
      listTrack.classList.add('show');
      $('.bullet').removeClass('active');
      bulletLyric.classList.add('active');
    }

    console.log(indexSwiper);

    // reset globalEvent
    globalEvent.reset();
  })

  // handle toggle speaker-button
  speakerButton.addEventListener('click', function(){
    this.classList.contains('active') ? this.classList.remove('active') : this.classList.add('active');
  })

  // handle toggle modify list track
  listBtn.addEventListener('click', function(){
    toggleModify('list');
  })

  gridBtn.addEventListener('click', function(){
    toggleModify('grid');
  })

  // handle toggle setting
  settingBtn.addEventListener('click', function(){
    toggleClass(modalSetting, "show");
  })

  // handle setting
  let settingItemArr = Array.from(settingItem);
  settingItemArr.map((e, i)=>{
    if (i === 0 || i === 1) {
      let data = e.getAttribute("data-target");
      e.addEventListener('click', function(){
        toggleClass(e, "active");
        eval(data)();
      })
    }
  })

  // handle input search
  closeBtnModalArr = Array.from(closeBtnModal);
  closeBtnModalArr.map(e=>{
    e.addEventListener('click', function(){
      if (e.closest('.modal-01')) {
        e.closest('.modal-01').classList.remove('show');
      }
    })
  })

  // scroll volume
  ballVolume.addEventListener('mousedown', function(e){
    globalEvent.clickBallVolume = true;
  })

  ballVolume.addEventListener('mousemove', function(e){
    try {
      if(globalEvent.clickBallVolume) {
        mouseObject.setCurrentPos(e.pageX, e.pageY);
        // console.log(e.pageY + "moving");
        volume_posY = e.pageY - speaker_volume_posY;
        if (e.pageY - speaker_volume_posY < - 1) {
          volume_posY = 0;
        } else if (e.pageY - speaker_volume_posY > 111) {
          volume_posY = 100;
        } else {
          volume_posY = e.pageY - speaker_volume_posY;
        }

        ballVolume.style.top = volume_posY + '%';
        speakerProgress.style.top = volume_posY + '%';
        window.sound.setVolume( (100 - volume_posY)*0.01 );
      }
    } catch(err) {
      console.log('co loi: ' + err);
    }
  });

    /// upload music
    $('#file-upload__file').on('change', function(event) {
      event.preventDefault();
      // console.log($(this).val());
      $(this).prev('.name').text($(this).val());
    });

  $(upload_link).on('click', function(event) {
    event.preventDefault();
    $(modal_upload).addClass('show');
  });
$('#submit-upload-music').on('click', function(event) {
    event.preventDefault();
    let lyric = $('.file-upload__lyric').val();
    if (lyric.length === 0) {
      lyric = "Chưa có lyric cho bài hát này";
    } else {
      lyric = lyric.replace(/[.]/g, "</br>");
    }

    // if ($('#file-upload__name').length > 0 && $('#file-upload__file').) {}
    $('.file-upload__lyric').val(lyric);
    console.log($('#file-upload__file').val());
    if(validateInputFile()) {
      $(this).closest('.upload-form-01').submit();
    }  
  });

  let changeValidateInput = () => {
    if(!$('#file-upload__name').val()) {
      $('#file-upload__name').closest('.input-item').children('.err').addClass('show');
      return false;
    } else {
      $('#file-upload__name').closest('.input-item').children('.err').removeClass('show');
    }

    if(!$('#file-upload__file').val()) {
      $('#file-upload__file').closest('.input-item').children('.err').addClass('show');
      return false;
    } else {
      $('#file-upload__file').closest('.input-item').children('.err').removeClass('show');
    }

    return true;
  }

  $('#file-upload__name').on('change', function(event) {
    changeValidateInput();
  });

  $('#file-upload__file').on('change', function(event) {
    changeValidateInput();
  });

  let validateInputFile = ()=>{
    return changeValidateInput();
  }
// FULL SCREEN
function openFullscreen(elem) {
  if (elem.requestFullscreen) {
    elem.requestFullscreen();
  } else if (elem.mozRequestFullScreen) { /* Firefox */
    elem.mozRequestFullScreen();
  } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
    elem.webkitRequestFullscreen();
  } else if (elem.msRequestFullscreen) { /* IE/Edge */
    elem.msRequestFullscreen();
  }
}

/* Close fullscreen */
function closeFullscreen(elem) {
  if (document.exitFullscreen) {
    document.exitFullscreen();
  } else if (document.mozCancelFullScreen) { /* Firefox */
    document.mozCancelFullScreen();
  } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
    document.webkitExitFullscreen();
  } else if (document.msExitFullscreen) { /* IE/Edge */
    document.msExitFullscreen();
  }
}

$(document).on('keyup', function(event) {
  event.preventDefault();
  if (event.keyCode === 49) {
    var elem = document.documentElement;
    openFullscreen(elem);
    $('.menu-wrapper').addClass('invi');
    $('.Header--01').addClass('invi');
    $('.pagination-01').addClass('invi');
    $('#settingBtn').addClass('invi');
    $('.play-view-infor-wrapper').addClass('invi');
    $('.control-main-wrapper').addClass('play-view-show');
  }
  if (event.keyCode === 50) {
    var elem = document.documentElement;
    closeFullscreen(elem);
    $('.menu-wrapper').removeClass('invi');
    $('.Header--01').removeClass('invi');
    $('.pagination-01').removeClass('invi');
    $('#settingBtn').removeClass('invi');
    $('.play-view-infor-wrapper').removeClass('invi');
    $('.control-main-wrapper').removeClass('play-view-show');
  }
});

$('.trigger').click(function(event) {
  $(this).toggleClass('active');
  $('.menu-01').toggleClass('show');
});

  // handle document click
  document.addEventListener('click', function(e){
    let target = e.target;

    // let inputItem = document.getElementsByClassName('input-item');
    // for(var ele of inputItem){
    //  if (!$(ele).is(target) && $(ele).has(target).length === 0 && $(ele).find('input').val().length == 0) {
    //    $(ele).find('.label-01').removeClass('up');
    //  }
    // }

    if (!$('.search-wrapper').is(target) && $('.search-wrapper').has(target).length === 0 ) {
      // console.log("close search result");
      hideSearchResult();
    }
  });
});